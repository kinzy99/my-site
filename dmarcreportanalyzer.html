<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMARC Report Analyzer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            color: #333;
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, #6A1B9A 0%, #AB47BC 100%);
            padding: 20px;
            text-align: center;
            color: white;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            color: white; /* Explicitly white for the title */
        }
        
        main {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .tool-section {
            background-color: #EDE7F6;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border: 2px solid #AB47BC;
        }
        
        h1, h2 {
            color: #6A1B9A;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            padding: 10px;
            font-family: monospace;
            border: 1px solid #AB47BC;
            border-radius: 4px;
            background-color: white;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus {
            border-color: #6A1B9A;
            box-shadow: 0 0 10px rgba(106, 27, 154, 0.3);
        }
        
        button {
            background-color: #6A1B9A;
            border: none;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            border-radius: 4px;
            margin-top: 10px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        button:hover {
            background-color: #AB47BC;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            border: 2px solid #AB47BC;
        }
        
        table, th, td {
            border: 1px solid #AB47BC;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
        }
        
        th {
            background-color: #6A1B9A;
            color: white;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #EDE7F6;
        }
        
        tr:hover {
            background-color: rgba(171, 71, 188, 0.1);
        }
        
        .error {
            color: #AB47BC;
            font-weight: bold;
            background-color: #EDE7F6;
            padding: 10px;
            border-radius: 4px;
            border: none;
        }
        
        @media (max-width: 600px) {
            main {
                padding: 10px;
            }
            .tool-section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>DMARC Report Analyzer</h1>
        <p>Paste your DMARC XML report below and analyze it.</p>
    </header>
    
    <main>
        <section class="tool-section">
            <h2>Upload XML Report</h2>
            <p>Copy and paste the content of your DMARC XML file here (only XML format is accepted).</p>
            <textarea id="xmlInput" placeholder="Paste your XML here..."></textarea>
            <button id="analyzeButton">Analyze Report</button>
            <div id="errorMessage" class="error"></div>
            <div id="dmarcResult"></div>
        </section>
    </main>
    
    <script>
        document.getElementById('analyzeButton').addEventListener('click', function() {
            const xmlText = document.getElementById('xmlInput').value;
            const errorDiv = document.getElementById('errorMessage');
            const resultsDiv = document.getElementById('dmarcResult');
            
            errorDiv.textContent = '';
            resultsDiv.innerHTML = '';
            
            if (!isValidXML(xmlText)) {
                errorDiv.textContent = 'Error: The input is not valid XML.';
                return;
            }
            
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
                
                if (xmlDoc.getElementsByTagName('parsererror').length > 0) {
                    errorDiv.textContent = 'Error: The XML contains parsing errors.';
                    return;
                }
                
                const records = xmlDoc.getElementsByTagName('record');
                if (records.length === 0) {
                    errorDiv.textContent = 'Error: No records found in the XML.';
                    return;
                }
                
                let tableHTML = '<table><thead><tr><th>Sender Domain</th><th>SPF Result</th><th>DKIM Result</th><th>DMARC Result</th><th>Sender IP</th><th>Date</th><th>Email Volume</th><th>Status</th></tr></thead><tbody>';
                
                for (let i = 0; i < records.length; i++) {
                    const row = records[i].getElementsByTagName('row')[0];
                    const identifiers = records[i].getElementsByTagName('identifiers')[0];
                    const headerFrom = identifiers?.getElementsByTagName('header_from')[0]?.textContent || 'N/A';
                    if (row) {
                        const sourceIp = row.getElementsByTagName('source_ip')[0]?.textContent || 'N/A';
                        const count = row.getElementsByTagName('count')[0]?.textContent || 'N/A';
                        const disposition = row.getElementsByTagName('policy_evaluated')[0]?.getElementsByTagName('disposition')[0]?.textContent || 'N/A';
                        const authResults = records[i].getElementsByTagName('auth_results')[0];
                        const spfResult = authResults?.getElementsByTagName('spf')[0]?.getAttribute('result') || 'N/A';
                        const dkimResult = authResults?.getElementsByTagName('dkim')[0]?.getAttribute('result') || 'N/A';
                        const date = xmlDoc.getElementsByTagName('date_range')[0]?.getElementsByTagName('begin')[0]?.textContent || 'N/A';
                        let status = 'N/A';
                        if (disposition) {
                            if (disposition.toLowerCase() === 'none') status = 'Received';
                            else if (disposition.toLowerCase() === 'quarantine') status = 'Quarantined';
                            else if (disposition.toLowerCase() === 'reject') status = 'Rejected';
                        }
                        
                        tableHTML += `<tr>
                            <td>${headerFrom}</td>
                            <td>${spfResult}</td>
                            <td>${dkimResult}</td>
                            <td>${disposition}</td>
                            <td>${sourceIp}</td>
                            <td>${date}</td>
                            <td>${count}</td>
                            <td>${status}</td>
                        </tr>`;
                    }
                }
                
                tableHTML += '</tbody></table>';
                resultsDiv.innerHTML = tableHTML;
            } catch (error) {
                errorDiv.textContent = 'Error: Failed to analyze the XML.';
                console.error(error);
            }
        });
        
        function isValidXML(text) {
            try {
                const parser = new DOMParser();
                parser.parseFromString(text, 'text/xml');
                return true;
            } catch (e) {
                return false;
            }
        }
    </script>
</body>
</html>
