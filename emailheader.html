<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Email Header Analyzer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            color: #333;
            line-height: 1.6;
        }
        header {
            background: linear-gradient(135deg, #6f42c1 0%, #9c27b0 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
        }
        .container {
            max-width: 900px;
            margin: 40px auto;
            padding: 30px;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        form {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #f3e5f5 0%, #e8f5e8 100%);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid #e1bee7;
        }
        label {
            font-weight: bold;
            color: #6f42c1;
            font-size: 1.1em;
        }
        textarea {
            padding: 15px;
            border: 2px solid #e1bee7;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background-color: white;
            resize: vertical;
            min-height: 200px;
            font-family: 'Courier New', monospace;
        }
        textarea:focus {
            outline: none;
            border-color: #6f42c1;
            box-shadow: 0 0 10px rgba(111, 66, 193, 0.3);
        }
        button {
            background: linear-gradient(135deg, #6f42c1 0%, #9c27b0 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            align-self: flex-start;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(111, 66, 193, 0.4);
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #result {
            margin-top: 20px;
        }
        .loading {
            text-align: center;
            color: #6f42c1;
            font-size: 1.2em;
            padding: 20px;
        }
        .loading i {
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error {
            color: #dc3545;
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
        }
        .result-section {
            margin-bottom: 40px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f5e8 100%);
            border-radius: 15px;
            border-left: 5px solid #6f42c1;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .result-section h3 {
            color: #6f42c1;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            background: white;
            margin-top: 15px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 15px;
            border: 1px solid #e1bee7;
            text-align: left;
            font-size: 14px;
        }
        th {
            background: linear-gradient(135deg, #6f42c1 0%, #9c27b0 100%);
            color: white;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f8f9ff;
        }
        tr:hover {
            background-color: rgba(111, 66, 193, 0.1);
        }
        .no-headers {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 1px solid #e1bee7;
        }
        .email-address {
            font-weight: bold;
            color: #6f42c1;
            background-color: #f8f9ff;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
            margin-top: 5px;
        }
        .auth-result {
            color: #28a745;
            font-weight: bold;
        }
        .auth-fail {
            color: #dc3545;
            font-weight: bold;
        }
        .auth-none {
            color: #ffc107;
            font-weight: bold;
        }
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            margin-top: 40px;
            background-color: rgba(255,255,255,0.8);
            border-radius: 10px;
            margin: 40px auto 20px;
            max-width: 900px;
        }
        @media (max-width: 600px) {
            .container {
                margin: 20px;
                padding: 20px;
            }
            form {
                padding: 20px;
            }
            textarea, button {
                width: 100%;
            }
            table {
                font-size: 12px;
            }
            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1><i class="fas fa-envelope-open-text"></i> Email Header Analyzer</h1>
        <p>Paste email headers to parse and view them in a structured table format.</p>
    </header>
    
    <div class="container">
        <form onsubmit="analyzeHeaders(); return false;">
            <label for="emailHeaders"><i class="fas fa-clipboard"></i> Paste Email Headers:</label>
            <textarea id="emailHeaders" placeholder="Paste the full email headers here (e.g., from Gmail: Show original > Copy to clipboard)...&#10;&#10;Example:&#10;From: John Doe &lt;john@example.com&gt;&#10;To: Jane Smith &lt;jane@recipient.com&gt;&#10;Subject: Test Email&#10;Date: Mon, 1 Jan 2024 12:00:00 +0000&#10;Message-ID: &lt;abc123@example.com&gt;&#10;Received: from mail.example.com (mail.example.com [192.0.2.1]) by...&#10;Authentication-Results: spf=pass smtp.mailfrom=example.com; dkim=pass header.i=@example.com; dmarc=pass policy.published=reject&#10;X-Mailer: Some Client (ignored)&#10;------=_Part_338296_1471629830.1760007019278 (boundary - content after this ignored)" required></textarea>
            
            <button type="submit"><i class="fas fa-analyze"></i> Analyze Headers</button>
        </form>
        
        <div id="result"></div>
    </div>
    
    <footer>
        <p>&copy; 2023 Email Header Analyzer. For educational use only.</p>
    </footer>
    
    <script>
        function extractEmail(value) {
            // Extract email from formats like "Name <email@domain.com>" or just "email@domain.com"
            const emailMatch = value.match(/<([^>]+)>/);
            if (emailMatch) {
                return emailMatch[1].trim();
            }
            // If no <>, check if the whole value looks like an email
            const simpleEmailMatch = value.match(/^[^\s<]+@[^\s>]+$/);
            if (simpleEmailMatch) {
                return simpleEmailMatch[0].trim();
            }
            return value.trim(); // Fallback to original if no email found
        }
        
        function parseAuthResults(value) {
            const parts = value.split(';').map(p => p.trim()).filter(p => p);
            const results = { spf: '', dkim: '', dmarc: '' };
            
            parts.forEach(part => {
                if (part.startsWith('spf=')) {
                    results.spf = part;
                } else if (part.startsWith('dkim=')) {
                    results.dkim = part;
                } else if (part.startsWith('dmarc=')) {
                    results.dmarc = part;
                }
            });
            
            return results;
        }
        
        function getAuthClass(status) {
            if (status.includes('pass')) return 'auth-result';
            if (status.includes('fail') || status.includes('reject')) return 'auth-fail';
            if (status.includes('none') || status.includes('neutral')) return 'auth-none';
            return '';
        }
        
        function analyzeHeaders() {
            const headersText = document.getElementById('emailHeaders').value.trim();
            const resultDiv = document.getElementById('result');
            if (!headersText) {
                resultDiv.innerHTML = `<div class="error"><i class="fas fa-exclamation-triangle"></i> Please paste email headers.</div>`;
                return;
            }
            resultDiv.innerHTML = `<div class="loading"><i class="fas fa-spinner"></i> Analyzing headers...</div>`;
            
            try {
                const lines = headersText.split(/\r?\n/);
                const parsedHeaders = {};
                let currentKey = '';
                let currentValue = '';
                let ignoreAfterBoundary = false;
                
                lines.forEach((line, index) => {
                    line = line.trim();
                    if (line === '') return; // Skip empty lines
                    
                    // Check for MIME boundary (e.g., lines starting with "------=" or similar)
                    if (line.startsWith('-----') && line.includes('=') && !ignoreAfterBoundary) {
                        ignoreAfterBoundary = true;
                        return; // Stop processing after boundary
                    }
                    
                    if (ignoreAfterBoundary) return; // Ignore everything after boundary
                    
                    if (line.includes(':')) {
                        // Save previous header if exists (but ignore if it's a long/custom X- header)
                        if (currentKey && currentValue && !currentKey.toLowerCase().startsWith('x-')) {
                            parsedHeaders[currentKey.toLowerCase()] = currentValue.trim();
                        }
                        // New header - check if it's not X- and not the last incomplete row
                        const colonIndex = line.indexOf(':');
                        currentKey = line.substring(0, colonIndex).trim();
                        currentValue = line.substring(colonIndex + 1).trim();
                        
                        // Ignore X- headers (e.g., X-Mailer, X-Originating-IP)
                        if (currentKey.toLowerCase().startsWith('x-')) {
                            currentKey = '';
                            currentValue = '';
                            return;
                        }
                        
                        // Ignore if it's the last line and incomplete (no colon or very short)
                        if (index === lines.length - 1 && colonIndex === -1) {
                            currentKey = '';
                            currentValue = '';
                            return;
                        }
                    } else if (currentKey && currentValue && !currentKey.toLowerCase().startsWith('x-')) {
                        // Multi-line continuation (append with space or newline)
                        currentValue += '\n' + line;
                    }
                });
                
                // Save the last header (if valid and not X-)
                if (currentKey && currentValue && !currentKey.toLowerCase().startsWith('x-')) {
                    parsedHeaders[currentKey.toLowerCase()] = currentValue.trim();
                }
                
                // Render table if headers found
                if (Object.keys(parsedHeaders).length === 0) {
                    resultDiv.innerHTML = `<div class="result-section">
                        <h3><i class="fas fa-info-circle"></i> Analysis Results</h3>
                        <div class="no-headers">No valid headers found. Ensure the input contains lines with 'Key: Value' format (X- headers and content after MIME boundaries are ignored).</div>
                    </div>`;
                    return;
                }
                
                let rows = '';
                Object.keys(parsedHeaders).forEach(key => {
                    let displayValue = parsedHeaders[key].replace(/\n/g, '<br>'); // Preserve multi-line in HTML
                    const displayKey = key.charAt(0).toUpperCase() + key.slice(1).replace(/-(.)/g, (match, g) => ' ' + g.toUpperCase());
                    
                    // Special handling for From and To: Extract and highlight full email address
                    if (key.toLowerCase() === 'from' || key.toLowerCase() === 'to') {
                        const email = extractEmail(parsedHeaders[key]);
                        displayValue = `${displayValue}<br><span class="email-address">Full Email: ${email}</span>`;
                    }
                    
                    // Special handling for Authentication-Results: Split into SPF, DKIM, DMARC rows
                    if (key.toLowerCase() === 'authentication-results') {
                        const authParts = parseAuthResults(parsedHeaders[key]);
                        
                        // SPF Row
                        if (authParts.spf) {
                            const spfClass = getAuthClass(authParts.spf);
                            rows += `
                                <tr>
                                    <td>Authentication-Results: SPF</td>
                                    <td><span class="${spfClass}">${authParts.spf}</span></td>
                                </tr>
                            `;
                        }
                        
                        // DKIM Row
                        if (authParts.dkim) {
                            const dkimClass = getAuthClass(authParts.dkim);
                            rows += `
                                <tr>
                                    <td>Authentication-Results: DKIM</td>
                                    <td><span class="${dkimClass}">${authParts.dkim}</span></td>
                                </tr>
                            `;
                        }
                        
                        // DMARC Row
                        if (authParts.dmarc) {
                            const dmarcClass = getAuthClass(authParts.dmarc);
                            rows += `
                                <tr>
                                    <td>Authentication-Results: DMARC</td>
                                    <td><span class="${dmarcClass}">${authParts.dmarc}</span></td>
                                </tr>
                            `;
                        }
                        
                        return; // Skip adding the original row
                    }
                    
                    rows += `
                        <tr>
                            <td>${displayKey}</td>
                            <td>${displayValue}</td>
                        </tr>
                    `;
                });
                
                const html = `<div class="result-section">
                    <h3><i class="fas fa-table"></i> Parsed Email Headers</h3>
                    <table>
                        <tr><th>Tag</th><th>Field</th></tr>
                        ${rows}
                    </table>
                    <p style="margin-top: 15px; font-style: italic; color: #666;">Total headers parsed: ${Object.keys(parsedHeaders).length} (X- headers, incomplete last row, and content after MIME boundaries ignored; Authentication-Results split into sub-rows)</p>
                </div>`;
                
                resultDiv.innerHTML = html;
                
            } catch (err) {
                resultDiv.innerHTML = `<div class="error"><i class="fas fa-times-circle"></i> Analysis failed: ${err.message}</div>`;
            }
        }
    </script>
</body>
</html>
